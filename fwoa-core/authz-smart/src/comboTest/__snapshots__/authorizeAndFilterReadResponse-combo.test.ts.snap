// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 0",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 1",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 4,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 2",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 3",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 4",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/Patient.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 5",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 6",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "user/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 7",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 8",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Condition.read",
        "system/Patient.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 9",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 4,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 10",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 11",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 12",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 13",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 14",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 15",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 16",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 17",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 4,
  "previousTotal": 4,
  "total": 4,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 18",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 19",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 20",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 21",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 22",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 23",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "system/Patient.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 24",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/Patient.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 25",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 26",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 27",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 28",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Condition",
        "id": "example",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
        },
        "clinicalStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
              "code": "active"
            }
          ]
        },
        "verificationStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
              "code": "confirmed"
            }
          ]
        },
        "category": [
          {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis"
              },
              {
                "system": "http://snomed.info/sct",
                "code": "439401001",
                "display": "Diagnosis"
              }
            ]
          }
        ],
        "severity": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "24484000",
              "display": "Severe"
            }
          ]
        },
        "code": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "39065001",
              "display": "Burn of ear"
            }
          ],
          "text": "Burnt Ear"
        },
        "bodySite": [
          {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "49521004",
                "display": "Left external ear structure"
              }
            ],
            "text": "Left Ear"
          }
        ],
        "onsetDateTime": "2012-05-24"
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 29",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 3,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 30",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/Patient.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 4,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 31",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 32",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/MedicationRequest.read",
        "system/MedicationRequest.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 3,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 33",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Patient",
        "id": "id",
        "meta": {
          "versionId": "1",
          "lastUpdated": "2020-06-28T12:03:29.421+00:00"
        },
        "name": [
          {
            "given": [
              "JONNY"
            ]
          }
        ],
        "gender": "male",
        "birthDate": "1972-10-13",
        "address": [
          {
            "city": "Ruppertshofen"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 34",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Condition.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 3,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 35",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Condition",
        "id": "example",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
        },
        "clinicalStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
              "code": "active"
            }
          ]
        },
        "verificationStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
              "code": "confirmed"
            }
          ]
        },
        "category": [
          {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis"
              },
              {
                "system": "http://snomed.info/sct",
                "code": "439401001",
                "display": "Diagnosis"
              }
            ]
          }
        ],
        "severity": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "24484000",
              "display": "Severe"
            }
          ]
        },
        "code": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "39065001",
              "display": "Burn of ear"
            }
          ],
          "text": "Burnt Ear"
        },
        "bodySite": [
          {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "49521004",
                "display": "Left external ear structure"
              }
            ],
            "text": "Left Ear"
          }
        ],
        "onsetDateTime": "2012-05-24"
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 36",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 37",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 38",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 39",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 40",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 41",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 4,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 42",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 43",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/Condition.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 44",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "MedicationRequest",
        "id": "self-tylenol",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
        },
        "identifier": [
          {
            "use": "official",
            "system": "http://acme.org/prescriptions",
            "value": "12345689"
          }
        ],
        "status": "active",
        "intent": "plan",
        "reportedBoolean": true,
        "medicationCodeableConcept": {
          "coding": [
            {
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
              "code": "1187314",
              "display": "Tylenol PM Pill"
            }
          ],
          "text": "Tylenol PM Pill"
        },
        "subject": {
          "reference": "https://fhir.server.com/dev/Patient/id"
        },
        "encounter": {
          "reference": "Encounter/example-1",
          "display": "Office Visit"
        },
        "authoredOn": "2019-06-24",
        "requester": {
          "reference": "Patient/example",
          "display": "**self-prescribed**"
        },
        "dosageInstruction": [
          {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 45",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 3,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 46",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 3,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 47",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Condition",
        "id": "example",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
        },
        "clinicalStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
              "code": "active"
            }
          ]
        },
        "verificationStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
              "code": "confirmed"
            }
          ]
        },
        "category": [
          {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis"
              },
              {
                "system": "http://snomed.info/sct",
                "code": "439401001",
                "display": "Diagnosis"
              }
            ]
          }
        ],
        "severity": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "24484000",
              "display": "Severe"
            }
          ]
        },
        "code": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "39065001",
              "display": "Burn of ear"
            }
          ],
          "text": "Burnt Ear"
        },
        "bodySite": [
          {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "49521004",
                "display": "Left external ear structure"
              }
            ],
            "text": "Left Ear"
          }
        ],
        "onsetDateTime": "2012-05-24"
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 48",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 49",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read",
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 50",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": [
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 4,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 51",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 52",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 53",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 54",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": [
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 3,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 55",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Condition",
        "id": "example",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
        },
        "clinicalStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
              "code": "active"
            }
          ]
        },
        "verificationStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
              "code": "confirmed"
            }
          ]
        },
        "category": [
          {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis"
              },
              {
                "system": "http://snomed.info/sct",
                "code": "439401001",
                "display": "Diagnosis"
              }
            ]
          }
        ],
        "severity": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "24484000",
              "display": "Severe"
            }
          ]
        },
        "code": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "39065001",
              "display": "Burn of ear"
            }
          ],
          "text": "Burnt Ear"
        },
        "bodySite": [
          {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "49521004",
                "display": "Left external ear structure"
              }
            ],
            "text": "Left Ear"
          }
        ],
        "onsetDateTime": "2012-05-24"
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "user/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 56",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 3,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 57",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Patient",
        "id": "notSamePatient",
        "meta": {
          "versionId": "1",
          "lastUpdated": "2020-06-28T12:03:29.421+00:00"
        },
        "name": [
          {
            "given": [
              "JONNY"
            ]
          }
        ],
        "gender": "male",
        "birthDate": "1972-10-13",
        "address": [
          {
            "city": "Ruppertshofen"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": [
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 58",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": [
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 59",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 60",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 4,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 61",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 62",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 63",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 64",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 65",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 4,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 66",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/Patient.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 3,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 67",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Patient",
        "id": "id",
        "meta": {
          "versionId": "1",
          "lastUpdated": "2020-06-28T12:03:29.421+00:00"
        },
        "name": [
          {
            "given": [
              "JONNY"
            ]
          }
        ],
        "gender": "male",
        "birthDate": "1972-10-13",
        "address": [
          {
            "city": "Ruppertshofen"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 68",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Patient",
        "id": "notSamePatient",
        "meta": {
          "versionId": "1",
          "lastUpdated": "2020-06-28T12:03:29.421+00:00"
        },
        "name": [
          {
            "given": [
              "JONNY"
            ]
          }
        ],
        "gender": "male",
        "birthDate": "1972-10-13",
        "address": [
          {
            "city": "Ruppertshofen"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "finalTotal": undefined,
  "previousTotal": undefined,
  "resource": Object {
    "address": Array [
      Object {
        "city": "Ruppertshofen",
      },
    ],
    "birthDate": "1972-10-13",
    "gender": "male",
    "id": "notSamePatient",
    "meta": Object {
      "lastUpdated": "2020-06-28T12:03:29.421+00:00",
      "versionId": "1",
    },
    "name": Array [
      Object {
        "given": Array [
          "JONNY",
        ],
      },
    ],
    "resourceType": "Patient",
  },
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 69",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/MedicationRequest.read",
        "system/Patient.read"
      ],
      "usableScopes": [
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 3,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 70",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 71",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 72",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 3,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 73",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "MedicationRequest",
        "id": "self-tylenol",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
        },
        "identifier": [
          {
            "use": "official",
            "system": "http://acme.org/prescriptions",
            "value": "12345689"
          }
        ],
        "status": "active",
        "intent": "plan",
        "reportedBoolean": true,
        "medicationCodeableConcept": {
          "coding": [
            {
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
              "code": "1187314",
              "display": "Tylenol PM Pill"
            }
          ],
          "text": "Tylenol PM Pill"
        },
        "subject": {
          "reference": "https://fhir.server.com/dev/Patient/id"
        },
        "encounter": {
          "reference": "Encounter/example-1",
          "display": "Office Visit"
        },
        "authoredOn": "2019-06-24",
        "requester": {
          "reference": "Patient/example",
          "display": "**self-prescribed**"
        },
        "dosageInstruction": [
          {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 74",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 75",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 76",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 77",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 78",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 79",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 80",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 4,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 81",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 82",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Patient.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 3,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 83",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Patient",
        "id": "notSamePatient",
        "meta": {
          "versionId": "1",
          "lastUpdated": "2020-06-28T12:03:29.421+00:00"
        },
        "name": [
          {
            "given": [
              "JONNY"
            ]
          }
        ],
        "gender": "male",
        "birthDate": "1972-10-13",
        "address": [
          {
            "city": "Ruppertshofen"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 84",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Patient",
        "id": "id",
        "meta": {
          "versionId": "1",
          "lastUpdated": "2020-06-28T12:03:29.421+00:00"
        },
        "name": [
          {
            "given": [
              "JONNY"
            ]
          }
        ],
        "gender": "male",
        "birthDate": "1972-10-13",
        "address": [
          {
            "city": "Ruppertshofen"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 85",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 3,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 86",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 4,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 87",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 88",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": [
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 89",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 90",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "system/Patient.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 91",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 92",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 93",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 94",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 95",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 4,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 96",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 97",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 98",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Condition",
        "id": "example",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
        },
        "clinicalStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
              "code": "active"
            }
          ]
        },
        "verificationStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
              "code": "confirmed"
            }
          ]
        },
        "category": [
          {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis"
              },
              {
                "system": "http://snomed.info/sct",
                "code": "439401001",
                "display": "Diagnosis"
              }
            ]
          }
        ],
        "severity": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "24484000",
              "display": "Severe"
            }
          ]
        },
        "code": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "39065001",
              "display": "Burn of ear"
            }
          ],
          "text": "Burnt Ear"
        },
        "bodySite": [
          {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "49521004",
                "display": "Left external ear structure"
              }
            ],
            "text": "Left Ear"
          }
        ],
        "onsetDateTime": "2012-05-24"
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 99",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "user/Condition.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 3,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 100",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 3,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 101",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Patient",
        "id": "notSamePatient",
        "meta": {
          "versionId": "1",
          "lastUpdated": "2020-06-28T12:03:29.421+00:00"
        },
        "name": [
          {
            "given": [
              "JONNY"
            ]
          }
        ],
        "gender": "male",
        "birthDate": "1972-10-13",
        "address": [
          {
            "city": "Ruppertshofen"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/Patient.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 102",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Condition.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 103",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 104",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Patient",
        "id": "id",
        "meta": {
          "versionId": "1",
          "lastUpdated": "2020-06-28T12:03:29.421+00:00"
        },
        "name": [
          {
            "given": [
              "JONNY"
            ]
          }
        ],
        "gender": "male",
        "birthDate": "1972-10-13",
        "address": [
          {
            "city": "Ruppertshofen"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "system/Patient.read"
      ],
      "usableScopes": [
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 105",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "user/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 3,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 106",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 107",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 108",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "system/Patient.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 109",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 4,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 110",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 111",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 112",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Patient",
        "id": "notSamePatient",
        "meta": {
          "versionId": "1",
          "lastUpdated": "2020-06-28T12:03:29.421+00:00"
        },
        "name": [
          {
            "given": [
              "JONNY"
            ]
          }
        ],
        "gender": "male",
        "birthDate": "1972-10-13",
        "address": [
          {
            "city": "Ruppertshofen"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 113",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": [
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 3,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 114",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 115",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 116",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "MedicationRequest",
        "id": "self-tylenol",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
        },
        "identifier": [
          {
            "use": "official",
            "system": "http://acme.org/prescriptions",
            "value": "12345689"
          }
        ],
        "status": "active",
        "intent": "plan",
        "reportedBoolean": true,
        "medicationCodeableConcept": {
          "coding": [
            {
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
              "code": "1187314",
              "display": "Tylenol PM Pill"
            }
          ],
          "text": "Tylenol PM Pill"
        },
        "subject": {
          "reference": "https://fhir.server.com/dev/Patient/id"
        },
        "encounter": {
          "reference": "Encounter/example-1",
          "display": "Office Visit"
        },
        "authoredOn": "2019-06-24",
        "requester": {
          "reference": "Patient/example",
          "display": "**self-prescribed**"
        },
        "dosageInstruction": [
          {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 117",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 3,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 118",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "MedicationRequest",
        "id": "self-tylenol",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
        },
        "identifier": [
          {
            "use": "official",
            "system": "http://acme.org/prescriptions",
            "value": "12345689"
          }
        ],
        "status": "active",
        "intent": "plan",
        "reportedBoolean": true,
        "medicationCodeableConcept": {
          "coding": [
            {
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
              "code": "1187314",
              "display": "Tylenol PM Pill"
            }
          ],
          "text": "Tylenol PM Pill"
        },
        "subject": {
          "reference": "https://fhir.server.com/dev/Patient/id"
        },
        "encounter": {
          "reference": "Encounter/example-1",
          "display": "Office Visit"
        },
        "authoredOn": "2019-06-24",
        "requester": {
          "reference": "Patient/example",
          "display": "**self-prescribed**"
        },
        "dosageInstruction": [
          {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 119",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 3,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 120",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 3,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 121",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Condition",
        "id": "example",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
        },
        "clinicalStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
              "code": "active"
            }
          ]
        },
        "verificationStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
              "code": "confirmed"
            }
          ]
        },
        "category": [
          {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis"
              },
              {
                "system": "http://snomed.info/sct",
                "code": "439401001",
                "display": "Diagnosis"
              }
            ]
          }
        ],
        "severity": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "24484000",
              "display": "Severe"
            }
          ]
        },
        "code": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "39065001",
              "display": "Burn of ear"
            }
          ],
          "text": "Burnt Ear"
        },
        "bodySite": [
          {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "49521004",
                "display": "Left external ear structure"
              }
            ],
            "text": "Left Ear"
          }
        ],
        "onsetDateTime": "2012-05-24"
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 122",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 123",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 4,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 124",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 125",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "system/Patient.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 126",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 127",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 4,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 128",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Patient",
        "id": "notSamePatient",
        "meta": {
          "versionId": "1",
          "lastUpdated": "2020-06-28T12:03:29.421+00:00"
        },
        "name": [
          {
            "given": [
              "JONNY"
            ]
          }
        ],
        "gender": "male",
        "birthDate": "1972-10-13",
        "address": [
          {
            "city": "Ruppertshofen"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 129",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "user/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 3,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 130",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 131",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 4,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 132",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/MedicationRequest.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 133",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": [
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 134",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Condition",
        "id": "example",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
        },
        "clinicalStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
              "code": "active"
            }
          ]
        },
        "verificationStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
              "code": "confirmed"
            }
          ]
        },
        "category": [
          {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis"
              },
              {
                "system": "http://snomed.info/sct",
                "code": "439401001",
                "display": "Diagnosis"
              }
            ]
          }
        ],
        "severity": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "24484000",
              "display": "Severe"
            }
          ]
        },
        "code": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "39065001",
              "display": "Burn of ear"
            }
          ],
          "text": "Burnt Ear"
        },
        "bodySite": [
          {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "49521004",
                "display": "Left external ear structure"
              }
            ],
            "text": "Left Ear"
          }
        ],
        "onsetDateTime": "2012-05-24"
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 135",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 3,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 136",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 4,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 137",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": [
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 138",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 3,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 139",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Condition",
        "id": "example",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
        },
        "clinicalStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
              "code": "active"
            }
          ]
        },
        "verificationStatus": {
          "coding": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
              "code": "confirmed"
            }
          ]
        },
        "category": [
          {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis"
              },
              {
                "system": "http://snomed.info/sct",
                "code": "439401001",
                "display": "Diagnosis"
              }
            ]
          }
        ],
        "severity": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "24484000",
              "display": "Severe"
            }
          ]
        },
        "code": {
          "coding": [
            {
              "system": "http://snomed.info/sct",
              "code": "39065001",
              "display": "Burn of ear"
            }
          ],
          "text": "Burnt Ear"
        },
        "bodySite": [
          {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "49521004",
                "display": "Left external ear structure"
              }
            ],
            "text": "Left Ear"
          }
        ],
        "onsetDateTime": "2012-05-24"
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "system/Patient.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 140",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 3,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 141",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "Patient",
        "id": "id",
        "meta": {
          "versionId": "1",
          "lastUpdated": "2020-06-28T12:03:29.421+00:00"
        },
        "name": [
          {
            "given": [
              "JONNY"
            ]
          }
        ],
        "gender": "male",
        "birthDate": "1972-10-13",
        "address": [
          {
            "city": "Ruppertshofen"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 142",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 143",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 144",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 145",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read",
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 146",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 147",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 148",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 3,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 149",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "MedicationRequest",
        "id": "self-tylenol",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
        },
        "identifier": [
          {
            "use": "official",
            "system": "http://acme.org/prescriptions",
            "value": "12345689"
          }
        ],
        "status": "active",
        "intent": "plan",
        "reportedBoolean": true,
        "medicationCodeableConcept": {
          "coding": [
            {
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
              "code": "1187314",
              "display": "Tylenol PM Pill"
            }
          ],
          "text": "Tylenol PM Pill"
        },
        "subject": {
          "reference": "https://fhir.server.com/dev/Patient/id"
        },
        "encounter": {
          "reference": "Encounter/example-1",
          "display": "Office Visit"
        },
        "authoredOn": "2019-06-24",
        "requester": {
          "reference": "Patient/example",
          "display": "**self-prescribed**"
        },
        "dosageInstruction": [
          {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 150",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 3,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 151",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/Patient.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 2,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 152",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 3,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 153",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 154",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "search-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 3,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 155",
  "request": {
    "readResponse": {
      "total": 0,
      "entry": []
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "operation": "search-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": false,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 0,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 156",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/Patient.read",
        "system/Patient.read",
        "system/MedicationRequest.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "search-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 3,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 157",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "search-system",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 1,
  "previousTotal": 2,
  "total": 1,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 158",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "authoredOn": "2019-06-24",
        "dosageInstruction": Array [
          Object {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs",
          },
        ],
        "encounter": Object {
          "display": "Office Visit",
          "reference": "Encounter/example-1",
        },
        "id": "self-tylenol",
        "identifier": Array [
          Object {
            "system": "http://acme.org/prescriptions",
            "use": "official",
            "value": "12345689",
          },
        ],
        "intent": "plan",
        "medicationCodeableConcept": Object {
          "coding": Array [
            Object {
              "code": "1187314",
              "display": "Tylenol PM Pill",
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
            },
          ],
          "text": "Tylenol PM Pill",
        },
        "reportedBoolean": true,
        "requester": Object {
          "display": "**self-prescribed**",
          "reference": "Patient/example",
        },
        "resourceType": "MedicationRequest",
        "status": "active",
        "subject": Object {
          "reference": "https://fhir.server.com/dev/Patient/id",
        },
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>",
          "status": "generated",
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 3,
  "previousTotal": 3,
  "total": 3,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 159",
  "request": {
    "readResponse": {
      "total": 3,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "system/Patient.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "operation": "history-type",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "N/A",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "N/A",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [],
  "finalTotal": 0,
  "previousTotal": 3,
  "total": 0,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 160",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/MedicationRequest.read",
        "patient/Condition.read",
        "user/Patient.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "N/A",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": false,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 161",
  "request": {
    "readResponse": {
      "total": 2,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev"
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "operation": "history-system",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": false,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": false
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "bodySite": Array [
          Object {
            "coding": Array [
              Object {
                "code": "49521004",
                "display": "Left external ear structure",
                "system": "http://snomed.info/sct",
              },
            ],
            "text": "Left Ear",
          },
        ],
        "category": Array [
          Object {
            "coding": Array [
              Object {
                "code": "encounter-diagnosis",
                "display": "Encounter Diagnosis",
                "system": "http://terminology.hl7.org/CodeSystem/condition-category",
              },
              Object {
                "code": "439401001",
                "display": "Diagnosis",
                "system": "http://snomed.info/sct",
              },
            ],
          },
        ],
        "clinicalStatus": Object {
          "coding": Array [
            Object {
              "code": "active",
              "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
            },
          ],
        },
        "code": Object {
          "coding": Array [
            Object {
              "code": "39065001",
              "display": "Burn of ear",
              "system": "http://snomed.info/sct",
            },
          ],
          "text": "Burnt Ear",
        },
        "id": "example",
        "onsetDateTime": "2012-05-24",
        "resourceType": "Condition",
        "severity": Object {
          "coding": Array [
            Object {
              "code": "24484000",
              "display": "Severe",
              "system": "http://snomed.info/sct",
            },
          ],
        },
        "subject": undefined,
        "text": Object {
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>",
          "status": "generated",
        },
        "verificationStatus": Object {
          "coding": Array [
            Object {
              "code": "confirmed",
              "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
            },
          ],
        },
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 2,
  "total": 2,
}
`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 162",
  "request": {
    "readResponse": {
      "resource": {
        "resourceType": "MedicationRequest",
        "id": "self-tylenol",
        "text": {
          "status": "generated",
          "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
        },
        "identifier": [
          {
            "use": "official",
            "system": "http://acme.org/prescriptions",
            "value": "12345689"
          }
        ],
        "status": "active",
        "intent": "plan",
        "reportedBoolean": true,
        "medicationCodeableConcept": {
          "coding": [
            {
              "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
              "code": "1187314",
              "display": "Tylenol PM Pill"
            }
          ],
          "text": "Tylenol PM Pill"
        },
        "subject": {
          "reference": "https://fhir.server.com/dev/Patient/id"
        },
        "encounter": {
          "reference": "Encounter/example-1",
          "display": "Office Visit"
        },
        "authoredOn": "2019-06-24",
        "requester": {
          "reference": "Patient/example",
          "display": "**self-prescribed**"
        },
        "dosageInstruction": [
          {
            "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
          }
        ]
      }
    },
    "operation": "read",
    "userIdentity": {
      "scopes": [
        "patient/MedicationRequest.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "user/Condition.read",
        "system/MedicationRequest.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/MedicationRequest.read": "patient/MedicationRequest.read",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "user/Condition.read",
    "system/Patient.read": "N/A",
    "system/MedicationRequest.read": "system/MedicationRequest.read",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": false,
    "matchPatient": false,
    "unmatchPatient": false
  }
} 1`] = `[UnauthorizedError: User does not have permission for requested resource]`;

exports[`authorizeAndFilterReadResponse-combo CASE: {
  "testName": "Combo Test Row 163",
  "request": {
    "readResponse": {
      "total": 4,
      "entry": [
        {
          "resource": {
            "resourceType": "Condition",
            "id": "example",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
            },
            "clinicalStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              ]
            },
            "verificationStatus": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                  "code": "confirmed"
                }
              ]
            },
            "category": [
              {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                    "code": "encounter-diagnosis",
                    "display": "Encounter Diagnosis"
                  },
                  {
                    "system": "http://snomed.info/sct",
                    "code": "439401001",
                    "display": "Diagnosis"
                  }
                ]
              }
            ],
            "severity": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "24484000",
                  "display": "Severe"
                }
              ]
            },
            "code": {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "39065001",
                  "display": "Burn of ear"
                }
              ],
              "text": "Burnt Ear"
            },
            "bodySite": [
              {
                "coding": [
                  {
                    "system": "http://snomed.info/sct",
                    "code": "49521004",
                    "display": "Left external ear structure"
                  }
                ],
                "text": "Left Ear"
              }
            ],
            "onsetDateTime": "2012-05-24"
          }
        },
        {
          "resource": {
            "resourceType": "MedicationRequest",
            "id": "self-tylenol",
            "text": {
              "status": "generated",
              "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p><b>Generated Narrative</b></p><p><b>id</b>: self-tylenol</p><p><b>identifier</b>: id: 12345689 (OFFICIAL)</p><p><b>status</b>: active</p><p><b>intent</b>: plan</p><p><b>reported</b>: true</p><p><b>medication</b>: <span title=\\"Codes: {http://www.nlm.nih.gov/research/umls/rxnorm 1187314}\\">Tylenol PM Pill</span></p><p><b>subject</b>: <a href=\\"Patient-example.html\\">Amy V. Shaw. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>encounter</b>: <a href=\\"Encounter-example-1.html\\">Office Visit. Generated Summary: id: example-1; status: finished; <span title=\\"{http://terminology.hl7.org/CodeSystem/v3-ActCode AMB}\\">ambulatory</span>; <span title=\\"Codes: {http://www.ama-assn.org/go/cpt 99201}\\">Office Visit</span>; period: 02/11/2015 9:00:14 AM --&gt; 02/11/2015 10:00:14 AM</a></p><p><b>authoredOn</b>: 2019-06-24</p><p><b>requester</b>: <a href=\\"Patient-example.html\\">**self-prescribed**. Generated Summary: id: example; Medical Record Number: 1032702 (USUAL); active; Amy V. Shaw , Amy V. Baxter ; ph: 555-555-5555(HOME), amy.shaw@example.com; gender: female; birthDate: 1987-02-20</a></p><p><b>dosageInstruction</b>: </p></div>"
            },
            "identifier": [
              {
                "use": "official",
                "system": "http://acme.org/prescriptions",
                "value": "12345689"
              }
            ],
            "status": "active",
            "intent": "plan",
            "reportedBoolean": true,
            "medicationCodeableConcept": {
              "coding": [
                {
                  "system": "http://www.nlm.nih.gov/research/umls/rxnorm",
                  "code": "1187314",
                  "display": "Tylenol PM Pill"
                }
              ],
              "text": "Tylenol PM Pill"
            },
            "subject": {
              "reference": "https://fhir.server.com/dev/Patient/id"
            },
            "encounter": {
              "reference": "Encounter/example-1",
              "display": "Office Visit"
            },
            "authoredOn": "2019-06-24",
            "requester": {
              "reference": "Patient/example",
              "display": "**self-prescribed**"
            },
            "dosageInstruction": [
              {
                "text": "Takes 1-2 tablets once daily at bedtime as needed for restless legs"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "id",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        },
        {
          "resource": {
            "resourceType": "Patient",
            "id": "notSamePatient",
            "meta": {
              "versionId": "1",
              "lastUpdated": "2020-06-28T12:03:29.421+00:00"
            },
            "name": [
              {
                "given": [
                  "JONNY"
                ]
              }
            ],
            "gender": "male",
            "birthDate": "1972-10-13",
            "address": [
              {
                "city": "Ruppertshofen"
              }
            ]
          }
        }
      ]
    },
    "operation": "search-type",
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.read",
        "user/MedicationRequest.read",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "usableScopes": [
        "system/Patient.read"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev"
  },
  "rawCsvRow": {
    "operation": "read",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/MedicationRequest.read": "N/A",
    "patient/Condition.read": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/MedicationRequest.read": "user/MedicationRequest.read",
    "user/Condition.read": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/MedicationRequest.read": "N/A",
    "system/Condition.read": "system/Condition.read",
    "matchMedicationRequest": true,
    "unmatchCondition": true,
    "matchPatient": true,
    "unmatchPatient": true
  }
} 1`] = `
Object {
  "entry": Array [
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "id",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
    Object {
      "resource": Object {
        "address": Array [
          Object {
            "city": "Ruppertshofen",
          },
        ],
        "birthDate": "1972-10-13",
        "gender": "male",
        "id": "notSamePatient",
        "meta": Object {
          "lastUpdated": "2020-06-28T12:03:29.421+00:00",
          "versionId": "1",
        },
        "name": Array [
          Object {
            "given": Array [
              "JONNY",
            ],
          },
        ],
        "resourceType": "Patient",
      },
    },
  ],
  "finalTotal": 2,
  "previousTotal": 4,
  "total": 2,
}
`;
